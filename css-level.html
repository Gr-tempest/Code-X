<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSS Levels - Code-X</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <div class="nav-brand">
                <a href="Code-X.html" class="back-button">‚Üê Back</a>
                <h1>CSS <span class="accent">Levels</span></h1>
            </div>
            <div class="nav-user">
                <span id="userName">User</span>
                <div class="level-xp">
                    Level <span id="currentLevel">1</span> ‚Ä¢ <span id="currentXP">0</span> XP
                </div>
            </div>
        </nav>

        <main class="level-main">
            <div class="level-container">
                <!-- Level Selector -->
                <div class="level-sidebar">
                    <h3>Levels</h3>
                    <div class="levels-grid" id="levelsGrid">
                        <!-- Levels will be populated by JavaScript -->
                    </div>
                </div>

                <!-- Level Content -->
                <div class="level-content">
                    <div class="level-header">
                        <h2 id="levelTitle">Select a Level</h2>
                        <div class="level-info">
                            <span class="level-number" id="levelNumber">-</span>
                            <span class="level-xp-badge" id="levelXp">0 XP</span>
                        </div>
                    </div>

                    <div class="level-instructions" id="levelInstructions">
                        <p>Select a level from the sidebar to begin your CSS learning journey!</p>
                    </div>

                    <div class="coding-area">
                        <div class="code-editor">
                            <div class="editor-header">
                                <span>CSS</span>
                                <div class="editor-actions">
                                    <button id="runCode" class="btn btn-primary btn-small">Run Code</button>
                                    <button id="resetCode" class="btn btn-outline btn-small">Reset</button>
                                </div>
                            </div>
                            <textarea id="cssCode" class="code-textarea" placeholder="Write your CSS code here..."></textarea>
                        </div>

                        <div class="code-preview">
                            <div class="preview-header">
                                <span>Preview</span>
                            </div>
                            <iframe id="previewFrame" class="preview-frame"></iframe>
                        </div>
                    </div>

                    <div class="level-actions">
                        <button id="checkSolution" class="btn btn-primary" disabled>Check Solution</button>
                        <button id="nextLevel" class="btn btn-outline" disabled>Next Level</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="progress.js"></script>
    <script src="css-levels.js"></script>
    <script>
        let currentLevel = 1;
        let cssLevels = [];

        function loadLevels() {
            cssLevels = getCssLevels();
            const levelsGrid = document.getElementById('levelsGrid');
            const progress = getProgress();
            
            levelsGrid.innerHTML = '';
            
            for (let i = 1; i <= 100; i++) {
                const level = cssLevels[i - 1];
                const isCompleted = progress.completedLevels.css.includes(i);
                const isUnlocked = i === 1 || progress.completedLevels.css.includes(i - 1);
                
                const levelEl = document.createElement('div');
                levelEl.className = `level-item ${isCompleted ? 'completed' : ''} ${!isUnlocked ? 'locked' : ''} ${i === currentLevel ? 'active' : ''}`;
                levelEl.innerHTML = `
                    <span class="level-item-number">${i}</span>
                    ${isCompleted ? '<span class="level-check">‚úì</span>' : ''}
                `;
                
                if (isUnlocked) {
                    levelEl.addEventListener('click', () => loadLevelContent(i));
                }
                
                levelsGrid.appendChild(levelEl);
            }
        }

        function loadLevelContent(levelNumber) {
            currentLevel = levelNumber;
            const level = cssLevels[levelNumber - 1];
            const progress = getProgress();
            
            // Update UI
            document.getElementById('levelTitle').textContent = level.title;
            document.getElementById('levelNumber').textContent = `Level ${levelNumber}`;
            document.getElementById('levelXp').textContent = `${level.xp} XP`;
            document.getElementById('levelInstructions').innerHTML = level.instructions;
            
            // Set starter code
            document.getElementById('cssCode').value = level.starterCode;
            
            // Update level items
            document.querySelectorAll('.level-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.level-item:nth-child(${levelNumber})`).classList.add('active');
            
            // Enable buttons
            document.getElementById('checkSolution').disabled = false;
            document.getElementById('nextLevel').disabled = !progress.completedLevels.css.includes(levelNumber);
            
            // Run initial code
            runCode();
        }

        function runCode() {
            const cssCode = document.getElementById('cssCode').value;
            const previewFrame = document.getElementById('previewFrame');
            const iframeDoc = previewFrame.contentDocument || previewFrame.contentWindow.document;
            
            iframeDoc.open();
            iframeDoc.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <style>
                        ${cssCode}
                    </style>
                </head>
                <body>
                    ${cssLevels[currentLevel - 1].htmlStructure || '<div class="container"><h1>CSS Preview</h1><p>Style this content using CSS!</p></div>'}
                </body>
                </html>
            `);
            iframeDoc.close();
        }

        function checkSolution() {
            const userCode = document.getElementById('cssCode').value;
            const level = cssLevels[currentLevel - 1];
            const progress = getProgress();
            
            // Simple validation
            let passed = true;
            
            // Check for required CSS properties
            if (level.requiredProperties) {
                level.requiredProperties.forEach(prop => {
                    if (!userCode.includes(prop)) {
                        passed = false;
                    }
                });
            }
            
            if (passed) {
                // Level completed!
                if (!progress.completedLevels.css.includes(currentLevel)) {
                    progress.completedLevels.css.push(currentLevel);
                    progress.totalXP += level.xp;
                    progress.totalTime += 5;
                    
                    // Update streak
                    const today = new Date().toDateString();
                    if (progress.lastCompleted !== today) {
                        progress.currentStreak++;
                        progress.lastCompleted = today;
                    }
                    
                    saveProgress(progress);
                    updateAchievements();
                    
                    alert(`üéâ Level ${currentLevel} completed! +${level.xp} XP`);
                }
                
                document.getElementById('nextLevel').disabled = false;
                loadLevels();
            } else {
                alert('‚ùå Not quite right. Check the requirements and try again!');
            }
        }

        function nextLevel() {
            if (currentLevel < 100) {
                loadLevelContent(currentLevel + 1);
            }
        }

        // Event listeners
        document.getElementById('runCode').addEventListener('click', runCode);
        document.getElementById('resetCode').addEventListener('click', () => {
            document.getElementById('cssCode').value = cssLevels[currentLevel - 1].starterCode;
            runCode();
        });
        document.getElementById('checkSolution').addEventListener('click', checkSolution);
        document.getElementById('nextLevel').addEventListener('click', nextLevel);

        // Initialize
        window.addEventListener('load', () => {
            const user = JSON.parse(localStorage.getItem('codex-user'));
            if (!user) {
                window.location.href = 'index.html';
                return;
            }
            
            document.getElementById('userName').textContent = user.name;
            
            const progress = getProgress();
            document.getElementById('currentLevel').textContent = progress.level;
            document.getElementById('currentXP').textContent = progress.totalXP;
            
            loadLevels();
            loadLevelContent(1);
        });
    </script>
     <footer class="main-footer animate-fadeInUp" style="animation-delay: 1.2s">
            <div class="footer-content">
                <div class="footer-info">
                    <p>Made by <a href="https://github.com/Gr-tempest">Gr-tempest</a></p>
                </div>
                <div class="social-links">
                    <a href="https://github.com" target="_blank" class="social-link hover-lift">
                        <i class="fab fa-github"></i>
                        GitHub
                    </a>
                    <a href="https://instagram.com" target="_blank" class="social-link hover-lift">
                        <i class="fab fa-instagram"></i>
                        Instagram
                    </a>
                    <a href="https://facebook.com" target="_blank" class="social-link hover-lift">
                        <i class="fab fa-facebook"></i>
                        Facebook
                    </a>
                </div>
            </div>
        </footer>
</body>
</html>