<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Code-X</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
</head>
<body>
    <div class="container">
        <nav class="navbar">
            <div class="nav-brand">
                <h1>Code<span class="accent">-X</span></h1>
            </div>
            <div class="nav-user">
                <span id="userName">User</span>
                <div class="user-actions">
                    <button id="exportData" class="btn btn-outline btn-small">Export Data</button>
                    <button id="logoutBtn" class="btn btn-outline btn-small">Logout</button>
                </div>
            </div>
        </nav>

        <main class="dashboard-main">
            <!-- Continue Progress Section -->
            <section class="continue-dashboard-section" id="continueDashboardSection" style="display: none;">
                <div class="continue-dashboard-card">
                    <h3>Continue Where You Left Off</h3>
                    <div id="continueOptions" class="continue-options">
                        <!-- Continue options will be populated here -->
                    </div>
                </div>
            </section>

            <!-- XP Progress -->
            <section class="xp-section">
                <div class="xp-header">
                    <h2>Your Coding Journey</h2>
                    <div class="xp-display">
                        <span id="currentXP">0</span> XP
                    </div>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="xpProgress"></div>
                </div>
                <div class="level-info">
                    Level <span id="currentLevel">1</span> ‚Ä¢ <span id="xpToNext">100</span> XP to next level
                </div>
            </section>

            <!-- Language Modules -->
            <section class="modules-section">
                <h2>Learn & Practice</h2>
                <div class="modules-grid">
                    <div class="module-card html-module">
                        <div class="module-icon">üìÑ</div>
                        <h3>HTML</h3>
                        <p>Structure the web with markup</p>
                        <div class="module-progress">
                            <div class="progress-bar small">
                                <div class="progress-fill" id="htmlProgress"></div>
                            </div>
                            <span id="htmlCompleted">0</span>/100
                        </div>
                        <button class="btn btn-primary" onclick="startModule('html')">Start Learning</button>
                    </div>

                    <div class="module-card css-module">
                        <div class="module-icon">üé®</div>
                        <h3>CSS</h3>
                        <p>Style and design beautiful websites</p>
                        <div class="module-progress">
                            <div class="progress-bar small">
                                <div class="progress-fill" id="cssProgress"></div>
                            </div>
                            <span id="cssCompleted">0</span>/100
                        </div>
                        <button class="btn btn-primary" onclick="startModule('css')">Start Learning</button>
                    </div>

                    <div class="module-card js-module">
                        <div class="module-icon">‚ö°</div>
                        <h3>JavaScript</h3>
                        <p>Add interactivity and logic</p>
                        <div class="module-progress">
                            <div class="progress-bar small">
                                <div class="progress-fill" id="jsProgress"></div>
                            </div>
                            <span id="jsCompleted">0</span>/100
                        </div>
                        <button class="btn btn-primary" onclick="startModule('js')">Start Learning</button>
                    </div>
                </div>
            </section>

            <!-- Achievements -->
            <section class="achievements-section">
                <h2>Recent Achievements</h2>
                <div class="achievements-grid" id="achievementsGrid">
                    <!-- Achievements will be loaded here -->
                </div>
            </section>

            <!-- Quick Stats -->
            <section class="stats-section">
                <h2>Your Progress</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <h3>Total Levels Completed</h3>
                        <div class="stat-number" id="totalCompleted">0</div>
                    </div>
                    <div class="stat-card">
                        <h3>Current Streak</h3>
                        <div class="stat-number" id="currentStreak">0 days</div>
                    </div>
                    <div class="stat-card">
                        <h3>Total Learning Time</h3>
                        <div class="stat-number" id="totalTime">0h 0m</div>
                    </div>
                    <div class="stat-card">
                        <h3>User Folder</h3>
                        <div class="stat-number" id="userFolder">-</div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="main-footer">
            <div class="footer-content">
                <div class="footer-info">
                    <p>Made with ‚ù§Ô∏è by <a href="mailto:sambradhanbartau@gmail.com">sambradhanbartau@gmail.com</a></p>
                </div>
                <div class="social-links">
                    <a href="https://github.com" target="_blank" class="social-link">
                        <i class="fab fa-github"></i>
                        GitHub
                    </a>
                    <a href="https://instagram.com" target="_blank" class="social-link">
                        <i class="fab fa-instagram"></i>
                        Instagram
                    </a>
                    <a href="https://facebook.com" target="_blank" class="social-link">
                        <i class="fab fa-facebook"></i>
                        Facebook
                    </a>
                </div>
            </div>
        </footer>
    </div>

    <script src="assets/js/progress.js"></script>
    <script src="assets/js/html-levels.js"></script>
    <script src="assets/js/css-levels.js"></script>
    <script src="assets/js/js-levels.js"></script>
    <script>
        function startModule(language) {
            window.location.href = `${language}-level.html`;
        }

        function getLastActiveLevel(language) {
            const progress = getProgress();
            const completed = progress.completedLevels[language];
            
            if (completed.length === 0) return 1;
            
            // Find the highest completed level
            const maxCompleted = Math.max(...completed);
            
            // Return next level if not all are completed, otherwise return the last level
            return maxCompleted < 100 ? maxCompleted + 1 : 100;
        }

        function showContinueOptions() {
            const progress = getProgress();
            const continueSection = document.getElementById('continueDashboardSection');
            const continueOptions = document.getElementById('continueOptions');
            
            const hasProgress = progress.completedLevels.html.length > 0 || 
                              progress.completedLevels.css.length > 0 || 
                              progress.completedLevels.js.length > 0;
            
            if (hasProgress) {
                continueSection.style.display = 'block';
                
                let optionsHTML = '';
                
                // HTML Continue Option
                if (progress.completedLevels.html.length > 0) {
                    const nextLevel = getLastActiveLevel('html');
                    optionsHTML += `
                        <div class="continue-option">
                            <div class="continue-info">
                                <h4>HTML</h4>
                                <p>Continue from Level ${nextLevel}</p>
                                <span class="progress-badge">${progress.completedLevels.html.length}/100 completed</span>
                            </div>
                            <button class="btn btn-primary" onclick="continueLearning('html', ${nextLevel})">Continue</button>
                        </div>
                    `;
                }
                
                // CSS Continue Option
                if (progress.completedLevels.css.length > 0) {
                    const nextLevel = getLastActiveLevel('css');
                    optionsHTML += `
                        <div class="continue-option">
                            <div class="continue-info">
                                <h4>CSS</h4>
                                <p>Continue from Level ${nextLevel}</p>
                                <span class="progress-badge">${progress.completedLevels.css.length}/100 completed</span>
                            </div>
                            <button class="btn btn-primary" onclick="continueLearning('css', ${nextLevel})">Continue</button>
                        </div>
                    `;
                }
                
                // JavaScript Continue Option
                if (progress.completedLevels.js.length > 0) {
                    const nextLevel = getLastActiveLevel('js');
                    optionsHTML += `
                        <div class="continue-option">
                            <div class="continue-info">
                                <h4>JavaScript</h4>
                                <p>Continue from Level ${nextLevel}</p>
                                <span class="progress-badge">${progress.completedLevels.js.length}/100 completed</span>
                            </div>
                            <button class="btn btn-primary" onclick="continueLearning('js', ${nextLevel})">Continue</button>
                        </div>
                    `;
                }
                
                continueOptions.innerHTML = optionsHTML;
            } else {
                continueSection.style.display = 'none';
            }
        }

        function continueLearning(language, level) {
            // Save the target level to localStorage for the level page to use
            localStorage.setItem(`codex-continue-${language}`, level.toString());
            window.location.href = `${language}-level.html`;
        }

        function updateDashboard() {
            const progress = getProgress();
            const user = progressTracker.getCurrentUser();
            
            // Update user info
            document.getElementById('userName').textContent = user?.name || 'Coder';
            
            // Update XP and level
            document.getElementById('currentXP').textContent = progress.totalXP;
            document.getElementById('currentLevel').textContent = progress.level;
            document.getElementById('xpToNext').textContent = progress.xpToNextLevel;
            document.getElementById('xpProgress').style.width = `${progress.xpPercentage}%`;
            
            // Update module progress
            const htmlCompleted = progress.completedLevels.html.length;
            const cssCompleted = progress.completedLevels.css.length;
            const jsCompleted = progress.completedLevels.js.length;
            
            document.getElementById('htmlCompleted').textContent = htmlCompleted;
            document.getElementById('cssCompleted').textContent = cssCompleted;
            document.getElementById('jsCompleted').textContent = jsCompleted;
            
            document.getElementById('htmlProgress').style.width = `${(htmlCompleted / 100) * 100}%`;
            document.getElementById('cssProgress').style.width = `${(cssCompleted / 100) * 100}%`;
            document.getElementById('jsProgress').style.width = `${(jsCompleted / 100) * 100}%`;
            
            // Update stats
            document.getElementById('totalCompleted').textContent = htmlCompleted + cssCompleted + jsCompleted;
            document.getElementById('currentStreak').textContent = `${progress.currentStreak} days`;
            document.getElementById('totalTime').textContent = `${Math.floor(progress.totalTime / 60)}h ${progress.totalTime % 60}m`;
            document.getElementById('userFolder').textContent = progress.userFolder ? 'Active' : 'Not Set';
            
            // Show continue options
            showContinueOptions();
            
            // Load achievements
            loadAchievements();
        }

        function loadAchievements() {
            const progress = getProgress();
            const userAchievements = progressTracker.getUserAchievements();
            const achievementsGrid = document.getElementById('achievementsGrid');
            achievementsGrid.innerHTML = '';
            
            const allAchievements = progressTracker.getAchievements();
            const unlocked = allAchievements.filter(achievement => 
                userAchievements.includes(achievement.id)
            ).slice(0, 6); // Show only 6 recent
            
            unlocked.forEach(achievement => {
                const achievementEl = document.createElement('div');
                achievementEl.className = 'achievement-card unlocked';
                achievementEl.innerHTML = `
                    <div class="achievement-icon">${achievement.icon}</div>
                    <div class="achievement-info">
                        <h4>${achievement.name}</h4>
                        <p>${achievement.description}</p>
                        <span class="achievement-xp">+${achievement.xp} XP</span>
                    </div>
                `;
                achievementsGrid.appendChild(achievementEl);
            });
            
            if (unlocked.length === 0) {
                achievementsGrid.innerHTML = '<p class="no-achievements">Complete levels to unlock achievements!</p>';
            }
        }

        // Export data functionality
        document.getElementById('exportData').addEventListener('click', () => {
            const data = exportUserData();
            if (data) {
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `codex-backup-${data.user.id}-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        });

        // Logout functionality
        document.getElementById('logoutBtn').addEventListener('click', () => {
            localStorage.removeItem('codex-current-user');
            window.location.href = 'code-landing.html';
        });

        // Check authentication
        window.addEventListener('load', () => {
            const user = progressTracker.getCurrentUser();
            if (!user) {
                window.location.href = 'code-landing.html';
                return;
            }
            
            updateDashboard();
        });
    </script>
</body>
</html>